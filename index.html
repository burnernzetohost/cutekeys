<!DOCTYPE html>
<html>
<head>
<title>LIVE KEYS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  background-color: #1B1C1D;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  margin: 0;
  font-family: sans-serif;
  padding-top: 50px;
  box-sizing: border-box;
}

h1 {
  color: #0000FF;
  font-size: 50px;
  margin: 0;
}

/* MODIFIED: Styling for the new status text */
#connection-status {
  font-size: 18px;
  font-weight: bold;
  margin-top: 8px;
  margin-bottom: 10px;
  color: #FFFFFF; /* White color for the user count */
  transition: color 0.3s ease;
}

.rectangle {
  width: 1000px;
  max-width: 95%;
  height: 500px;
  background-color: transparent;
  border: 3px solid white;
  border-radius: 25px;
  margin-top: 20px;
  padding: 15px;
  overflow-y: auto;
  box-sizing: border-box;
}

.rectangle p {
    color: white;
    margin: 5px 0;
    font-size: 16px;
    word-wrap: break-word;
}

@media (max-width: 768px) {
  body {
    padding-top: 20px;
  }
  h1 {
    font-size: 36px;
  }
  #connection-status {
      font-size: 16px;
  }
  .rectangle {
    width: 95%;
    height: 65vh;
    padding: 10px;
  }
}
</style>
</head>
<body>

<h1>LIVE KEYS</h1>
<p id="connection-status">Connecting...</p>
<div id="message-box" class="rectangle"></div>

<script>
    const messageBox = document.getElementById('message-box');
    const statusElement = document.getElementById('connection-status'); // Get the status element
    const ws = new WebSocket(`wss://NZE77-keys.hf.space/ws`); // Replace with your actual WebSocket URL

    let currentLineElement = null;

    // MODIFIED: The onmessage handler is now more powerful
    ws.onmessage = function(event) {
        // First, parse the incoming JSON data from the server
        const message = JSON.parse(event.data);

        // Check the type of the message
        if (message.type === 'status_update') {
            // If it's a status update, change the status text
            const userCount = message.count;
            statusElement.textContent = `${userCount} User(s) Online`;

        } else if (message.type === 'key_press') {
            // If it's a key press, perform the original typing logic
            const char = message.data;

            if (char === '[ENTER]') {
                currentLineElement = null;
                return;
            }

            if (currentLineElement === null) {
                currentLineElement = document.createElement('p');
                messageBox.prepend(currentLineElement);
            }

            currentLineElement.textContent += char;
        }
    };

    ws.onopen = function() {
        console.log("WebSocket connection established.");
        // The status text will be updated automatically when the first 'status_update' message arrives
    };

    ws.onclose = function() {
        console.log("WebSocket connection closed.");
        // Update the UI to show a disconnected state for this specific user
        statusElement.textContent = 'You are disconnected. Refresh to reconnect.';
        statusElement.style.color = '#E74C3C'; // Red
    };

    ws.onerror = function(error) {
        console.error("WebSocket Error: ", error);
        statusElement.textContent = 'Connection Error.';
        statusElement.style.color = '#E74C3C'; // Red
    };
</script>

</body>
</html>
